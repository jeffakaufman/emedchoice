"use strict";angular.module("emedchoiceApp",["ngCookies","ngResource","ngSanitize","leaflet-directive","ui.bootstrap","angularFileUpload","ngTable"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/providers",{templateUrl:"views/facilities.html",controller:"FacilitiesCtrl"}).when("/provider/:provider",{templateUrl:"views/details-facility.html",controller:"FacilitydetailsCtrl"}).when("/placements",{templateUrl:"views/placements.html",controller:"PlacementsCtrl"}).when("/choices",{templateUrl:"views/choices.html",controller:"ChoicesCtrl"}).when("/patientletter",{templateUrl:"views/patientletter.html",controller:"PatientletterCtrl"}).when("/providermanager",{templateUrl:"views/facilitymanager.html",controller:"FacilitymanagerCtrl"}).when("/editprovider/:provider",{templateUrl:"views/editfacility.html",controller:"EditfacilityCtrl"}).when("/watchlist",{templateUrl:"views/watchlist.html",controller:"WatchlistCtrl"}).when("/performance/:provider",{templateUrl:"views/history.html",controller:"HistoryCtrl"}).when("/referrals",{templateUrl:"views/referrals.html",controller:"ReferralsCtrl"}).when("/review/:token",{templateUrl:"views/review.html",controller:"ReviewCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).when("/incompatible",{templateUrl:"views/incompatible.html",controller:"IncompatibleCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Dataservice",function(a,b,c){a.$on("$routeChangeStart",function(){if("undefined"!=typeof Storage){a.user=c.get("user");var d=b.url(),e=String(d).match(/provider\//);a.user.id&&a.user.token||(b.url(e?d:"/login"),a.user={})}else b.url("/incompatible")}),a.$on("$routeChangeSuccess",function(){a.location=b})}]),NProgress.configure({minimum:.25,ease:"ease",speed:500}),toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-left",onclick:null},Highcharts.Data.prototype.dateFormats["m/d/Y"]={regex:"^([0-9]{1,2})/([0-9]{1,2})/([0-9]{2})$",parser:function(a){return Date.UTC(+("20"+a[3]),a[1]-1,+a[2])}},$(".infotip").popover({trigger:"hover"}),$(function(){$("body").on("keyup",".field-phone",function(){var a=this.selectionStart,b=/[^0-9]/gi,c=$(this).val();b.test(c)&&($(this).val(c.replace(b,"")),a--),this.setSelectionRange(a,a)})}),angular.module("emedchoiceApp").controller("MainCtrl",["$scope","$rootScope","Api","Search","Dataservice",function(a,b,c,d,e){b.search=e.get("search"),b.search.provider||(b.search=d.get()),b.vars={homepage:!0},b.isCollapsed=!0,a.today=function(){b.dt=new Date},a.today(),a.showWeeks=!0,b.toggleWeeks=function(){a.showWeeks=!a.showWeeks},b.clear=function(){b.dt=null},b.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},b.toggleMin=function(){b.minDate=b.minDate?null:new Date},b.toggleMin(),b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0},b.dateOptions={"year-format":"'yy'","starting-day":1},b.formats=["dd-MMMM-yyyy","yyyy-MM-dd","shortDate"],b.format=a.formats[1],c.listing_limit("facilities",10).then(function(b){a.facilities=b.data.data}),c.get_service_groups().then(function(a){b.service_groups=a.data.data}),c.get_services(b.search).then(function(a){b.services=a.data.data}),c.listing("insurances").then(function(a){b.insurances=a.data.data}),c.listing("diagnosis").then(function(a){b.diagnosis=a.data.data}),c.listing("program_types").then(function(a){b.program_types=a.data.data}),b.$watch("search.service_group",function(){c.get_services(b.search).then(function(a){b.services=a.data.data,b.search.service=b.services[0].id})},!0),b.$watch("search.service",function(a){b.search.services=[],b.search.services[parseInt(a)]=!0},!0),b.$watch("search",function(){e.set("search",b.search)},!0)}]),angular.module("emedchoiceApp").service("Api",["$http",function(a){var b="http://localhost/emedchoice/",c=function(c){var d=a.get(b+c).success(function(a){return a});return d},d=function(c,d){var e=a({method:"POST",url:b+c,data:d,headers:{"Access-Control-Allow-Origin":!0,"Content-Type":"application/json"}}).success(function(a){return a});return e};return{get_listing:function(a){return d("get_listing/",a)},get_records:function(a){return d("get_records/",a)},get_facility:function(a){return d("get_facility/",a)},get_facilities:function(a){return d("get_facilities/",a)},get_services:function(a){return d("get_services",a)},get_all_services:function(){return c("get_all_services")},get_placements:function(){return c("get_placements")},listing:function(a){return c("listing/"+a)},listing_limit:function(a,b){return c("listing/"+a+"/"+b)},load_facilities:function(){return c("load_facilities")},send_letter:function(a){return d("send_letter/",a)},add_service:function(a){return d("add_service",a)},remove_service:function(a){return d("remove_service",a)},add_provider:function(a){return d("add_provider",a)},add_user:function(a){return d("add_user",a)},remove_user:function(a){return d("remove_user",a)},save_facility:function(a){return d("save_facility",a)},remove_provider:function(a){return d("remove_provider",a)},remove_facility:function(a){return d("remove_facility",a)},create_facility:function(a){return d("create_facility",a)},create_service:function(a){return d("create_service",a)},create_provider:function(a){return d("create_provider",a)},watch_item:function(a){return d("watch_item",a)},get_watchlist:function(a){return d("get_watchlist",a)},watch_item_drop:function(a){return d("watch_item_drop",a)},get_referrals:function(a){return d("get_referrals",a)},remove_watchlist_item:function(a){return d("remove_watchlist_item",a)},get_history:function(a){return d("get_history",a)},report_avgcloseouttime:function(a){return d("report_avgcloseouttime",a)},report_referralsaccepted:function(a){return d("report_referralsaccepted",a)},report_referralsdeferred:function(a){return d("report_referralsdeferred",a)},report_hits:function(a){return d("report_hits",a)},report_conversions:function(a){return d("report_conversions",a)},report_totalsearches:function(a){return d("report_totalsearches",a)},report_monthlyreferrals:function(a){return d("report_monthlyreferrals",a)},report_qos:function(a){return d("report_qos",a)},report_bedsfilled:function(a){return d("report_bedsfilled",a)},validate_token:function(a){return d("validate_token",a)},login_user:function(a){return d("login_user",a)},validate_session:function(a){return d("validate_session",a)},get_affiliates:function(a){return d("get_affiliates",a)},get_cm_performace:function(a){return d("get_cm_performace",a)},process_review:function(a){return d("process_review",a)},get_latlon:function(a){return d("get_latlon",a)},save_profile:function(a){return d("save_profile",a)},add_staff:function(a){return d("add_staff",a)},get_service_groups:function(){return c("get_service_groups")},url:function(){return b}}}]),angular.module("emedchoiceApp").service("Search",function(){var a={location:{context:"facilities",city:"San Antonio",state:"Texas",zip:"78258",distance:"5",coords:{lat:29.4551018,lng:-98.4980617}},provider:"1",when:"Nov. 14th, 2013",anticipated_discharge_date:"Nov. 14th, 2013",beds:"",service:"1",service_group:"6",program_type:"Adult Day Care",diagnosis:"1",staff:"",do_proximity_search:!0,services:{}},b=function(b){return a=b};return{set:function(a){return b(a)},get:function(){return a}}}),angular.module("emedchoiceApp").filter("slugify",function(){return function(a){return String(a).toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}}),angular.module("emedchoiceApp").filter("lower",function(){return function(a){return new String(a).toLowerCase()}}),angular.module("emedchoiceApp").filter("slice",function(){return function(a,b,c){return a.slice(b,c)}}),angular.module("emedchoiceApp").controller("FacilitiesCtrl",["$scope","$http","Api","Search","$rootScope","Dataservice",function(a,b,c,d,e,f){a.filtered_facilities=[],a.currentPage=1,a.numPerPage=10,a.maxSize=5,a.pageCount=0,a.search=f.get("search"),a.search.provider||(a.search=d.get()),a.choices=f.get("choices",!0),a.test_name="choices",a.showPcl=function(){e.show_pcl=!0},angular.extend(a,{center:{lat:29.4167,lng:98.5,zoom:20},defaults:{scrollWheelZoom:!1}}),a.init=function(){Modernizr.geolocation&&(navigator.geolocation.getCurrentPosition(g),a.loadZip())};var g=function(b){a.search.coords=b.coords,a.center.lat=a.search.coords.latitude,a.center.lng=a.search.coords.longitude};a.update_main_table=function(){a.numPages=function(){return Math.ceil(a.facilities.length/a.numPerPage)},a.pageCount=a.facilities.length,a.$watch("currentPage + numPerPage",function(){var b=(a.currentPage-1)*a.numPerPage,c=b+a.numPerPage;a.filtered_facilities=a.facilities.slice(b,c)})},c.get_facilities(a.search).then(function(b){a.facilities=b.data.data,a.update_main_table(a.facilities)}),c.get_service_groups().then(function(a){e.service_groups=a.data.data}),c.get_services(a.search).then(function(b){a.services=b.data.data}),c.listing("insurances").then(function(b){a.insurances=b.data.data}),c.listing("program_types").then(function(b){a.program_types=b.data.data}),a.onUpdateZip=function(){NProgress.start(),$("#img-search-loader").show(),d.set(a.search),f.set("search",d.get()),c.get_facilities(a.search).then(function(b){a.facilities=b.data.data,a.loadZip(),a.update_main_table(a.facilities),$("#img-search-loader").hide(),NProgress.done()})},a.onViewMap=function(b){$("#modal-map").modal("show"),a.facility=b,a.search.coords.lat=parseFloat(a.facility.lat),a.search.coords.lng=parseFloat(a.facility.lng),a.center.lat=a.search.coords.latitude,a.center.lng=a.search.coords.longitude},a.addToChoices=function(b,c){var d=b.target;if(d.checked)a.choices.push(c);else{var g=a.choices.indexOf(c);g>-1&&a.choices.splice(g,1)}f.set("choices",a.choices),e.pcl_count=a.choices.length},a.inArray=function(b,c){var d=a[c],e=!1;return $.each(d,function(a,c){c.id===b&&(e=!0)}),e},a.loadZip=function(){c.get_latlon(a.search).then(function(b){var c=b.data.data;a.center.lat=parseFloat(c.latitude),a.center.lng=parseFloat(c.longitude)})},a.$watch("search.service_group",function(){a.search.services=[],c.get_services(a.search).then(function(b){a.services=b.data.data})},!0),a.onToggleService=function(b,c){var d=b.target;if(d.checked)null!==c.id&&"object"==typeof c&&a.search.services.push(c);else{var e=a.search.services.indexOf(c);e>-1&&a.search.services.splice(e,1)}}}]),angular.module("emedchoiceApp").controller("FacilitydetailsCtrl",["$scope","$http","Api","$routeParams","Dataservice","$rootScope",function(a,b,c,d,e){a.choices=e.get("choices",!0),a.user=e.get("user"),$("span.print").printPage(),a.staff_all={title:"!Affiliated Physician"},a.staff_doc={title:"Affiliated Physician"},a.current_image="http://placehold.it/468x312",a.add_placement=function(b){var c=parseInt(b),d=a.choices.indexOf(c);-1===d?(a.choices.push(c),e.set("choices",a.choices),toastr.success("Provider added to choices list")):toastr.error("Provider is already in your choices list")},angular.extend(a,{center:{lat:29.55696,lng:-98.66529,zoom:25},markers:{center:{lat:29.55696,lng:-98.66529,focus:!0,draggable:!1}},defaults:{scrollWheelZoom:!1}}),a.watch_item=function(b){var d={users_id:a.user.id,facilities_id:b};c.watch_item(d).then(function(a){var b=a.data;b.error?toastr.error(b.title):toastr.success("Provider added to your watchlist")})},a.print_provider=function(){},a.change_image=function(b){a.current_image=b},a.init=function(){c.get_facility(d).then(function(b){a.facility=b.data.data,a.current_image=a.facility.image_main;var c={lat:parseFloat(a.facility.lat),lng:parseFloat(a.facility.lng)};a.center.lat=c.lat,a.center.lng=c.lng,a.markers.center.lat=c.lat,a.markers.center.lng=c.lng})}}]),angular.module("emedchoiceApp").controller("PlacementsCtrl",["$scope","$http","Api","Search",function(a,b,c){c.get_placements().then(function(b){a.placements=b.data.data}),a.init=function(){}}]),angular.module("emedchoiceApp").service("Dataservice",[function(){var a=[1,2,3],b=function(){return Modernizr.localstorage?!0:!1},c=function(a,c,e){var f=[],g="undefined"!=typeof c?c:!1,h="undefined"!=typeof e?e:!1;if(b()){var i=localStorage.getItem(a);i?f=JSON.parse(i):g&&(h?d(a,h):d(a,[]))}return f},d=function(a,c){return JSON.stringify(c),b()?(localStorage.setItem(a,JSON.stringify(c)),!0):!1},e=function(){return b()?(localStorage.clear(),!0):!1},f=function(a,c){var e=[];if(b()){var f=JSON.parse(localStorage.getItem(a));f&&(f.push(c),d(a,f))}return e};return{get:function(a,b,d){return c(a,b,d)},set:function(a,b){d(a,b)},push:function(a,b){f(a,b)},trash:function(a){_cut(a)},nuke:function(){e()},test:function(){return a}}}]),angular.module("emedchoiceApp").controller("ChoicesCtrl",["$scope","$rootScope","Dataservice","Api",function(a,b,c,d){a.choices=c.get("choices"),a.init=function(){d.get_records({table:"facilities",records:a.choices}).then(function(b){a.facilities=b.data.data})},a.on_remove=function(b){var d=$.inArray(parseInt(b),a.choices);d>-1&&(a.choices.splice(d,1),c.set("choices",a.choices)),a.init()}}]),angular.module("emedchoiceApp").directive("cbchoices",["Dataservice",function(a){return{restrict:"E",template:'\n            <div class=""> \n                <label class="cb-choices"> \n                <input type="checkbox" class="cb-choice"/> \n                <span class="thinna">Include</span> \n                </label> \n            </div>',link:function(b,c,d){b.$watch(d,function(){var b=JSON.parse(d.choice);angular.forEach(a.get("choices"),function(a){a===b&&($("label",c).css({color:"green","font-weight":"normal"}),$("input",c).attr("checked","checked"))})}),$("input",c).bind("click",function(b){var e=JSON.parse(d.choice),f=b.target;if(f.checked)a.push("choices",parseInt($.trim(e))),$("label",c).css({color:"green","font-weight":"normal"});else{var g=[];angular.forEach(a.get("choices"),function(a){a!==e&&g.push(parseInt(a))},g),a.set("choices",g),$("label",c).css({color:"inherit","font-weight":"normal"})}console.log(a.get("choices"))})}}}]),angular.module("emedchoiceApp").controller("PatientletterCtrl",["$scope","$timeout","Dataservice","Api",function(a,b,c,d){a.choices=c.get("choices"),a.search=c.get("search"),a.user=c.get("user"),a.checkModel={left:!1,middle:!0,right:!1},a.letter={date_created:moment().format("MMMM Do YYYY, h:mm:ss a"),facility:"Methodist South Hospital",address:"1234 Main St, San Antonio, TX 78260",patient:"Jane Smith",email:"",bed_type:"3",mot:"Personal"},a.init=function(){d.get_records({table:"facilities",records:a.choices}).then(function(b){a.facilities=b.data.data})},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],d.listing("insurances").then(function(b){a.insurances=b.data.data}),a.sendChoiceLetter=function(){NProgress.start(),a.processing=!0;var b={users_id:a.user.id,search:a.search,choices:a.choices,letter:a.letter,html:$("#letter-body").html()};d.send_letter(b).then(function(b){a.processing=!1,NProgress.done(),console.log(b.data.data),a.status=b.data.data,$("#modal-letter-status").modal("show")})}}]),angular.module("emedchoiceApp").controller("FacilitymanagerCtrl",["$scope","$location","Api","Dataservice","ngTableParams",function(a,b,c,d,e){a.facilities=[],a.selected_facility={};var f=[];c.load_facilities().then(function(b){a.facilities=b.data.data,f=a.facilities,a.tableParams=new e({page:1,count:10},{total:f.length,getData:function(a,b){a.resolve(f.slice((b.page()-1)*b.count(),b.page()*b.count()))}})}),a.create_facility_pre=function(){a.selected_facility={},$("#modal-add-facility").modal("show")},a.create_facility=function(){var b=a.selected_facility;c.create_facility(b).then(function(b){a.selected_facility=b.data.data,$("#modal-add-facility").modal("hide"),toastr.success("facility created successfully"),c.load_facilities().then(function(b){a.facilities=b.data.data})})},a.remove_facility_pre=function(b){a.selected_facility=b,$("#modal-remove-facility").modal("show")},a.remove_facility=function(){var b=a.selected_facility;c.remove_facility(b).then(function(){$("#modal-remove-facility").modal("hide"),toastr.warning("facility removed successfully"),c.load_facilities().then(function(b){a.facilities=b.data.data})})},a.init=function(){}}]),angular.module("emedchoiceApp").controller("EditfacilityCtrl",["$scope","$upload","$routeParams","Api","Dataservice",function(a,b,c,d){d.get_all_services().then(function(b){a.services=b.data.data}),a.onFileSelect=function(c,e){if(a.selectedFiles=[],a.progress=[],a.upload&&a.upload.length>0)for(var f=0;f<a.upload.length;f++)null!==a.upload[f]&&a.upload[f].abort();a.upload=[],a.selectedFiles=c;for(var f=0;f<c.length;f++){var g=c[f];a.progress[f]=0,function(c){a.upload[c]=b.upload({url:d.url()+"ng_upload/",method:"POST",file:g}).then(function(b){toastr.success("image uploaded ok. refreshing the page..."),a.facility[e]="images/facilities/"+b.data.msg,a.save_facility()},null,function(b){a.progress[c]=parseInt(100*b.loaded/b.total)})}(f)}},a.add_service=function(b){var c={child_id:b.id,parent_id:a.facility.id};d.add_service(c).then(function(c){console.log(c.data.data),a.facility.services.push(b)})},a.remove_service=function(b){var c={child_id:b.id,parent_id:a.facility.id};d.remove_service(c).then(function(c){console.log(c.data.data);var d=a.facility.services.indexOf(b);d>-1&&a.facility.services.splice(d,1)})},a.add_provider=function(b){var c={child_id:b.id,parent_id:a.facility.id};d.add_provider(c).then(function(c){console.log(c.data.data),a.facility.providers.push(b)})},a.remove_provider=function(b){var c={child_id:b.id,parent_id:a.facility.id};d.remove_provider(c).then(function(c){console.log(c.data.data);var d=a.facility.providers.indexOf(b);d>-1&&a.facility.providers.splice(d,1)})},a.add_user=function(){d.add_user(a.staff).then(function(b){console.log(b.data),a.init()})},a.remove_user=function(b){d.remove_user(b).then(function(b){console.log(b.data),a.init()})},a.upload_images=function(){},a.save_facility=function(){var b=a.facility;d.save_facility(b).then(function(a){console.log(a.data.data),toastr.success("facility saved successfully")})},a.service={},a.provider={},a.create_service_pre=function(){$("#modal-create-service").modal("show")},a.create_provider_pre=function(){$("#modal-create-provider").modal("show")},a.create_provider=function(){var b=a.provider;d.create_provider(b).then(function(){$("#modal-create-provider").modal("hide"),toastr.success("provider created successfully"),d.listing("insurances").then(function(b){a.providers=b.data.data})})},a.create_service=function(){var b=a.service;d.create_service(b).then(function(){$("#modal-create-service").modal("hide"),toastr.success("service created successfully"),d.get_services().then(function(b){a.services=b.data.data})})},a.selected_user=void 0,a.set_user=function(){console.log(a.selected_user)},a.init=function(){d.listing("insurances").then(function(b){a.providers=b.data.data}),d.listing("users").then(function(b){a.users=b.data.data}),d.get_facility(c).then(function(b){a.facility=b.data.data,a.staff={fullname:"Shannons E Davis",title:"Corporate",email:"person@aol.com",is_doctor:!1,receive_sms:"0",phone:"(210) 123-4567",facilities_id:a.facility.id},a.$watch("staff",function(b,c){a.is_doctor=!1,"Doctor"===c&&(a.is_doctor=!0)})})}}]),angular.module("emedchoiceApp").filter("inArray",[function(){return function(a,b,c){var d=c[a],e=!1;for(var f in d)f.id===b&&(e=!0);return e}}]),angular.module("emedchoiceApp").filter("serviceProvided",[function(){return function(a,b){for(var c=!1,d=0;d<$(b).size();d++)b[d].id===a&&(c=!0);return c}}]),angular.module("emedchoiceApp").filter("insurancesAccepted",[function(){return function(a,b){for(var c=!1,d=0;d<$(b).size();d++)b[d].id===a&&(c=!0);return c}}]),angular.module("emedchoiceApp").directive("autoComplete",[function(a){return function(b,c,d){c.autocomplete({source:b[d.uiItems],select:function(){a(function(){c.trigger("input")},0)}})}}]),angular.module("emedchoiceApp").controller("WatchlistCtrl",["$scope","$http","Api","Dataservice",function(a,b,c,d){a.choices=d.get("choices",!0),a.user=d.get("user"),a.add_placement=function(b){var c=parseInt(b),e=a.choices.indexOf(c);-1===e?(a.choices.push(c),d.set("choices",a.choices),toastr.success("Provider added to choices list")):toastr.error("Provider is already in your choices list")},a.remove_watchlist_item=function(b){c.remove_watchlist_item({id:parseInt(b)}).then(function(b){a.init(),b.data.error?toastr.error(b.data.title):toastr.success("Provider removed from watchlist successfully")})},c.get_watchlist({users_id:a.user.id}).then(function(b){a.watchlist=b.data.data,console.log(a.watchlist)}),a.init=function(){c.get_watchlist({users_id:a.user.id}).then(function(b){a.watchlist=b.data.data})}}]),angular.module("emedchoiceApp").controller("HistoryCtrl",["$scope","$http","Api","$routeParams",function(a,b,c,d){a.init=function(){c.get_facility(d).then(function(b){a.facility=b.data.data,a.report_totalsearches=0,a.report_monthlyreferrals=0,a.report_bedsfilled=0,a.current_capacity=0,a.report_qos=0,a.report_avgcloseouttime=0,a.report_referralsaccepted=0,a.report_referralsdeferred=0,a.report_hits=0,a.report_conversions=0,a.report_totalsearches=0,a.report_hitpercentage=0,a.report_conversionpercentage=0,c.report_totalsearches(a.facility).then(function(b){b.data.error||(a.report_totalsearches=b.data.data)}),c.get_history(a.facility).then(function(b){a.history=b.data.data}),c.report_monthlyreferrals(a.facility).then(function(b){a.report_monthlyreferrals=b.data.data}),c.report_bedsfilled(a.facility).then(function(b){a.facility.current_capacity=b.data.msg,a.report_bedsfilled=b.data.data,$("#container-2").highcharts({chart:{polar:!0,type:"line"},title:{align:"left",text:"Bed Placement Performance"},subtitle:{align:"left",text:"Covering the last 30 days. Based on bed placement constraints set by the provider"},pane:{size:"80%"},xAxis:{categories:["Other","Skilled","Medicaid","Medicaid Pending","Charity"],tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},tooltip:{shared:!0,pointFormat:'<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}</b><br/>'},legend:{align:"right",verticalAlign:"top",y:70,layout:"vertical"},series:[{name:"Capacity / Goal",type:"area",data:[parseInt(a.facility.beds_other),parseInt(a.facility.beds_skilled),parseInt(a.facility.beds_medicaid),parseInt(a.facility.beds_medicaid_pending),parseInt(a.facility.beds_charity)],pointPlacement:"on"},{name:"Actual",data:a.report_bedsfilled,pointPlacement:"on"}]})}),c.report_qos(a.facility).then(function(b){a.report_qos=b.data.data,$("#container-3").highcharts({chart:{zoomType:"x",spacingRight:20},title:{text:"Quality Of Service (QoS) Timeline"},xAxis:{type:"datetime",tickInterval:26784e5,tickWidth:0,gridLineWidth:1,labels:{align:"left"}},yAxis:{title:{text:"QoS Score"}},tooltip:{shared:!0},legend:{enabled:!1},subtitle:{text:void 0===document.ontouchstart?"Based on the average response time of referrals accepted":"Based on the average response time of referrals accepted"},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:.7},stops:[[0,Highcharts.getOptions().colors[2]],[.9,Highcharts.Color(Highcharts.getOptions().colors[2]).setOpacity(0).get("rgba")]]},lineWidth:2,marker:{enabled:!1},shadow:!1,states:{hover:{lineWidth:2}},threshold:null}},series:[{name:"QoS Score",data:a.report_qos}]})}),c.report_avgcloseouttime(a.facility).then(function(b){if(!b.data.error){var c=b.data.data;a.facility.report_avgcloseouttime=c;var d,e=c.split(":");switch(d=e[0],!0){case d>=3:a.facility.rating="excellent";break;case d>2:a.facility.rating="great";break;default:a.facility.rating="fair"}}}),c.report_referralsaccepted(a.facility).then(function(b){b.data.error||(a.facility.report_referralsaccepted=b.data.data)}),c.report_referralsdeferred(a.facility).then(function(b){b.data.error||(a.facility.report_referralsdeferred=b.data.data)}),c.report_hits(a.facility).then(function(b){b.data.error||(a.facility.report_hits=b.data.data)}),c.report_conversions(a.facility).then(function(b){b.data.error||(a.facility.report_conversions=b.data.data)})})},a.$watch("facility.report_hits",function(b){var c=b/a.report_totalsearches*100;a.report_hitpercentage=Math.round(c)}),a.$watch("facility.report_conversions",function(b){var c=b/a.report_totalsearches*100;a.report_conversionpercentage=Math.round(c)})}]),angular.module("emedchoiceApp").controller("ReferralsCtrl",["$scope","$http","Api","$routeParams","Dataservice",function(a,b,c,d,e){a.user=e.get("user"),a.filter={users_id:a.user.id,status:0,bed_type:3,refid:""},a.statuses=["Pending","Accepted","Deferred"],a.beds=["none","Other","Skilled","Medicaid","Medicaid Pending","Charity"],a.init=function(){a.load_referrals()},a.$watch("filter.refid",function(a){""!==$.trim(a)?$(".withrefid").attr("disabled","disabled"):$(".withrefid").removeAttr("disabled")}),a.load_referrals=function(){a.user.is_admin||(a.filter.refid=""),c.get_referrals(a.filter).then(function(b){a.referrals=b.data.data})},a.clear=function(){a.filter.refid="",a.load_referrals()}}]),angular.module("emedchoiceApp").controller("ReviewCtrl",["$rootScope","$scope","$http","Api","$routeParams","$location",function(a,b,c,d,e){b.statuses=["Pending","Accepted","Deferred"],b.beds=["none","Other","Skilled","Medicaid","Medicaid Pending","Charity"],b.validation={token:e.token,error:!0,title:"Validating Request...",msg:"Please wait while we validate your referral review request."},b.$watch("validation.facility.status",function(a){switch(parseInt(a)){case 1:$("#facility_notes").removeAttr("disabled"),$("#facility_notes_label").show();break;case 2:$("#facility_notes").removeAttr("disabled"),$("#facility_notes_label").show();break;default:$("#facility_notes").attr("disabled","disabled"),$("#facility_notes_label").hide()}console.log(parseInt(a))}),b.init=function(){NProgress.start(),d.validate_token(b.validation).then(function(c){a.user.is_admin?(b.validation.error=c.data.data.error,b.validation.title=c.data.data.title,b.validation.msg=c.data.data.msg,b.validation.facility=c.data.data.facility,b.validation.error&&setTimeout(function(){window.location="https://www.google.com/"},5e3)):(b.validation.error=!0,b.validation.title="Invalid User Permissions",b.validation.msg="Only an administrator can override a review request for a referral. You only have "+a.user.account_type+" access."),NProgress.done()})},b.process_review=function(){NProgress.start(),b.validation.title="Processing review...",b.validation.msg="Please wait while we process your referral review.",a.user.is_admin?d.process_review(b.validation).then(function(a){var c=a.data;c.error?(b.validation.error=!0,b.validation.title=c.title,b.validation.msg=c.msg):(b.validation.error=!1,b.validation.title=c.title,b.validation.msg=c.msg,toastr.success(c.msg,c.title)),NProgress.done()}):(b.validation.error=!0,b.validation.title="Invalid Access",b.validation.msg="You do not have access to this system.",toastr.warning(b.validation.msg,b.validation.title),NProgress.done())}}]),angular.module("emedchoiceApp").controller("LoginCtrl",["$scope","$http","Api","$routeParams","Dataservice","$location",function(a,b,c,d,e,f){a.login_status={error:!1,msg:""},a.user={email:"",password:""},a.login_user=function(){c.login_user(a.user).then(function(b){var c=b.data;c.error?(a.user={},e.set("user",{}),a.login_status={error:!0,msg:"Incorrect credentials provided!"}):(toastr.success(c.msg,c.title),a.user=c.data,e.set("user",a.user),f.url("/"),a.login_status={error:!1,msg:""})})}}]),angular.module("emedchoiceApp").controller("LogoutCtrl",["$scope","$http","Api","$routeParams","Dataservice","$location",function(a,b,c,d,e,f){a.init=function(){a.user={},e.set("user",{}),f.url("/login")}}]),angular.module("emedchoiceApp").controller("IncompatibleCtrl",["$scope",function(){}]),angular.module("emedchoiceApp").controller("AccountCtrl",["$scope","$http","Api","$routeParams","Dataservice","$location","$rootScope","$upload",function(a,b,c,d,e,f,g,h){a.user_levels=["Guest","Case Manager","Case Manager Admin"],a.statuses=["Pending","Accepted","Deferred"],a.usr=g.user,a.init=function(){c.get_affiliates(g.user).then(function(b){a.affiliates=b.data.data}),c.get_cm_performace(g.user).then(function(b){a.referrals=b.data.data})},a.onSaveProfile=function(){c.save_profile(a.usr).then(function(a){a.data.error?toastr.error(a.data.msg,a.data.title):(g.user=a.data.data,e.set("user",g.user),toastr.success(a.data.msg,a.data.title))})},a.onFileSelect=function(b){if(a.selectedFiles=[],a.upload&&a.upload.length>0)for(var d=0;d<a.upload.length;d++)null!==a.upload[d]&&a.upload[d].abort();a.upload=[],a.selectedFiles=b;for(var d=0;d<b.length;d++){var e=b[d];!function(b){a.upload[b]=h.upload({url:c.url()+"ng_upload/",method:"POST",file:e}).then(function(b){toastr.success("image uploaded ok"),a.usr.photo=b.data.msg},null,function(){})}(d)}}}]),angular.module("emedchoiceApp").directive("errSrc",[function(){return{link:function(a,b,c){a.$watch(function(){return c.ngSrc},function(a){a||b.attr("src",c.errSrc)}),b.bind("error",function(){b.attr("src",c.errSrc)})}}}]);